<html>
  <body>
    <!--StartFragment-->
    <div style="color: #3c3836;background-color: #fbf1c7;font-family: Consolas, 'Courier New', monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;">
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">cache.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">config.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">object-store.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">userdiff.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">xdiff-interface.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">diff.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">diffcore.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">commit.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">quote.h</span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">include</span><span style="color: #af3a03;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">help.h</span><span style="color: #7c6f64;">"</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_is_binary</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> index_state </span><span style="color: #427b58;">*</span><span style="color: #076678;">istate</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">std_output</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">size</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">fwrite</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> stdout</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt grep_defaults </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .relative </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .pathname </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .max_depth </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .pattern_type_option </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_UNSPECIFIED</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .colors </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_CONTEXT</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">""</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_MAGENTA</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FUNCTION</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">""</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_LINENO</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_GREEN</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_COLUMNNO</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_GREEN</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_CONTEXT</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_BOLD_RED</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_SELECTED</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_BOLD_RED</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SELECTED</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">""</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SEP</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GIT_COLOR_CYAN</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">},</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .only_matching </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; .output </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> std_output</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #7c6f64;">};</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">color_grep_slots</span><span style="color: #af3a03;">[]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_CONTEXT</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; &#160;</span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">context</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">filename</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FUNCTION</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">function</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_LINENO</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">lineNumber</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_COLUMNNO</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">column</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_CONTEXT</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160;</span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">matchContext</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_SELECTED</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">matchSelected</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SELECTED</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">selected</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SEP</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> &#160; &#160; &#160; &#160;</span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">separator</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #7c6f64;">};</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">parse_pattern_type_arg</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">arg</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">arg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">default</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_UNSPECIFIED</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">arg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">basic</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_BRE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">arg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">extended</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_ERE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">arg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">fixed</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_FIXED</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">arg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">perl</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_PCRE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">bad </span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;"> argument: </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> arg</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #b57614;">define_list_config_array_extra</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">color_grep_slots</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">match</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">});</span></div>
      <br>
      <div><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* Read the configuration file once and store it in</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* the grep_defaults template.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;*/</span></div>
      <div><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_config</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">value</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">cb</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">opt </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">grep_defaults</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">slot</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">userdiff_config</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* The instance of grep_opt that we set up here is copied by</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* grep_init() to be used by each individual invocation.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* When populating a new field of this structure here, be</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* sure to think about ownership -- e.g., you might need to</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* override the shallow copy in grep_init() with a deep copy.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.extendedregexp</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">git_config_bool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.patterntype</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_type_option</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">parse_pattern_type_arg</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.linenumber</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">linenum</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">git_config_bool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.column</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">columnnum</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">git_config_bool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep.fullname</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">relative</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">git_config_bool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">color.grep</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">color</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">git_config_colorbool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">strcmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">color.grep.match</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">grep_config</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">color.grep.matchcontext</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cb</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">grep_config</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">color.grep.matchselected</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> value</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cb</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">skip_prefix</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">color.grep.</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">slot</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> i </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">LOOKUP_CONFIG</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">color_grep_slots</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> slot</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">color</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">i</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">value</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">config_error_nonbool</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">var</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">color_parse</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">value</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> color</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* Initialize one instance of grep_opt and copy the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* default values from the template we read the configuration</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* information in an earlier call to git_config(grep_config).</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;*/</span></div>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_init</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> repository </span><span style="color: #427b58;">*</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">prefix</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">opt </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> grep_defaults</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> repo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">prefix</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> prefix</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">prefix_length</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">prefix </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">prefix</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">prefix</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_tail</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_tail</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_set_pattern_type_option</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_pattern_type </span><span style="color: #076678;">pattern_type</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* When committing to the pattern type by setting the relevant</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* fields in grep_opt it's generally not necessary to zero out</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* the fields we're not choosing, since they won't have been</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* set by anything. The extended_regexp_option field is the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* only exception to this.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* This is because in the process of parsing grep.patternType</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* &amp; grep.extendedRegexp we set opt-&gt;pattern_type_option and</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* opt-&gt;extended_regexp_option, respectively. We then</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* internally use opt-&gt;extended_regexp_option to see if we're</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* compiling an ERE. It must be unset if that's not actually</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* the case.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pattern_type </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_ERE </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pattern_type</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_UNSPECIFIED</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* fall through */</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_BRE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_ERE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_FIXED</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_PCRE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_commit_pattern_type</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_pattern_type </span><span style="color: #076678;">pattern_type</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pattern_type </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_UNSPECIFIED</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_set_pattern_type_option</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pattern_type</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_type_option</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN_TYPE_UNSPECIFIED</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_set_pattern_type_option</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_type_option</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* This branch *must* happen after setting from the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* opt-&gt;pattern_type_option above, we don't want</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* grep.extendedRegexp to override grep.patternType!</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_set_pattern_type_option</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">GREP_PATTERN_TYPE_ERE</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #b57614;">create_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">patlen</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">no</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_pat_token </span><span style="color: #076678;">t</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_header_field </span><span style="color: #076678;">field</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xcalloc</span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xmemdupz</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> patlen</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> patlen</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> origin</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> no</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> t</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> field</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">do_append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">***</span><span style="color: #076678;">tail</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">**</span><span style="color: #3c3836;">tail </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">tail </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">:</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* atom */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(;;)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">new_pat</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> len </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">cp </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">nl </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">++</span><span style="color: #3c3836;">len </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">--</span><span style="color: #3c3836;">cp</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; nl </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> cp</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">nl</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; new_pat </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">create_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">nl </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> len </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">new_pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">tail </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">new_pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> new_pat</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">nl </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\0</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-=</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">append_header_grep_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_header_field </span><span style="color: #076678;">field</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">create_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">header</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> field</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">field </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_HEADER_REFLOG</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">use_reflog_filter</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">do_append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_tail</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">append_grep_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_pat_token </span><span style="color: #076678;">t</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> t</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">patlen</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_pat_token </span><span style="color: #076678;">t</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">create_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> patlen</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> t</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">do_append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_tail</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_opt_dup</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">pat</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">ret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xmalloc</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">ret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">ret</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">ret</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_tail</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">ret</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pat </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> pat </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> pat </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">append_header_grep_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ret</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">append_grep_pat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ret</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pat</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> ret</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> NORETURN </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_regexp_failed</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">error</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">where</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">1024</span><span style="color: #7c6f64;">];</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xsnprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">where</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">where</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">In '</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">' at </span><span style="color: #8f3f71;">%d</span><span style="color: #79740e;">, </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xsnprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">where</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">where</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">, </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">origin</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">where</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">'</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">': </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> where</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> error</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">is_fixed</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">s</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">len</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> i</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> i </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> i</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">is_regex_special</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">s</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">i</span><span style="color: #7c6f64;">]))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">ifdef</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">USE_LIBPCRE2</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">define</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">GREP_PCRE2_DEBUG_MALLOC</span><span style="color: #af3a03;"> </span><span style="color: #8f3f71;">0</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #b57614;">pcre2_malloc</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">PCRE2_SIZE </span><span style="color: #076678;">size</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> MAYBE_UNUSED </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">memory_data</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">pointer </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">malloc</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">if</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">GREP_PCRE2_DEBUG_MALLOC</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> count </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">fprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">stderr</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">PCRE2:</span><span style="color: #8f3f71;">%p</span><span style="color: #79740e;"> -&gt; #</span><span style="color: #8f3f71;">%02d</span><span style="color: #79740e;">: alloc(</span><span style="color: #8f3f71;">%lu</span><span style="color: #79740e;">)</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pointer</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> count</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> pointer</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_free</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pointer</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> MAYBE_UNUSED </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">memory_data</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">if</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">GREP_PCRE2_DEBUG_MALLOC</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> count </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pointer</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">fprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">stderr</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">PCRE2:</span><span style="color: #8f3f71;">%p</span><span style="color: #79740e;"> -&gt; #</span><span style="color: #8f3f71;">%02d</span><span style="color: #79740e;">: free()</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pointer</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> count</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">pointer</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> error</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; PCRE2_UCHAR </span><span style="color: #076678;">errbuf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">256</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; PCRE2_SIZE erroffset</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> options </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> PCRE2_MULTILINE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> jitret</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> patinforet</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> jitsizearg</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> literal </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* Call pcre2_general_context_create() before calling any</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* other pcre2_*(). It sets up our malloc()/free() functions</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* with which everything else is allocated.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_general_context_create</span><span style="color: #7c6f64;">(</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; pcre2_malloc</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pcre2_free</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Couldn't allocate PCRE2 general context</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_locale</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">has_non_ascii</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_tables</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_maketables</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_compile_context</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_compile_context_create</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">pcre2_set_character_tables</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_compile_context</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_tables</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; options </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> PCRE2_CASELESS</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_locale</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">is_utf8_locale</span><span style="color: #7c6f64;">()</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">literal</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; options </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">PCRE2_UTF </span><span style="color: #427b58;">|</span><span style="color: #3c3836;"> PCRE2_MATCH_INVALID_UTF</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">ifdef</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">GIT_PCRE2_VERSION_10_36_OR_HIGHER</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Work around https://bugs.exim.org/show_bug.cgi?id=2642 fixed in 10.36 */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">PCRE2_MATCH_INVALID_UTF </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> options </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">PCRE2_UTF </span><span style="color: #427b58;">|</span><span style="color: #3c3836;"> PCRE2_CASELESS</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; options </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> PCRE2_NO_START_OPTIMIZE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_compile</span><span style="color: #7c6f64;">((</span><span style="color: #3c3836;">PCRE2_SPTR</span><span style="color: #7c6f64;">)</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> options</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">error</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">erroffset</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_compile_context</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_match_data_create_from_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Couldn't allocate PCRE2 match data</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">pcre2_get_error_message</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">error</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">errbuf</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_regexp_failed</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">)</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">errbuf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_config</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">PCRE2_CONFIG_JIT</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_jit_on</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_jit_on</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; jitret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_jit_compile</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> PCRE2_JIT_COMPLETE</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">jitret</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Couldn't JIT the PCRE2 pattern '</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">', got '</span><span style="color: #8f3f71;">%d</span><span style="color: #79740e;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> jitret</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* The pcre2_config(PCRE2_CONFIG_JIT, ...) call just</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* tells us whether the library itself supports JIT,</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* but to see whether we're going to be actually using</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* JIT we need to extract PCRE2_INFO_JITSIZE from the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* pattern *after* we do pcre2_jit_compile() above.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* This is because if the pattern contains the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (*NO_JIT) verb (see pcre2syntax(3))</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* pcre2_jit_compile() will exit early with 0. If we</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* then proceed to call pcre2_jit_match() further down</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* the line instead of pcre2_match() we'll either</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* segfault (pre PCRE 10.31) or run into a fatal error</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (post PCRE2 10.31)</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; patinforet </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_pattern_info</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> PCRE2_INFO_JITSIZE</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">jitsizearg</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">patinforet</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">pcre2_pattern_info() failed: </span><span style="color: #8f3f71;">%d</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> patinforet</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">jitsizearg </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_jit_on</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2match</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> ret</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> flags </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; PCRE2_SIZE </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">ovector</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; PCRE2_UCHAR </span><span style="color: #076678;">errbuf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">256</span><span style="color: #7c6f64;">];</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">eflags </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;"> REG_NOTBOL</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; flags </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> PCRE2_NOTBOL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_jit_on</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; ret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_jit_match</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;">line</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> flags</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; ret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_match</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;">line</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> flags</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ret </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> ret </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> PCRE2_ERROR_NOMATCH</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">pcre2_get_error_message</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ret</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">errbuf</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;"> failed with error code </span><span style="color: #8f3f71;">%d</span><span style="color: #79740e;">: </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_jit_on</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">pcre2_jit_match</span><span style="color: #7c6f64;">"</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">pcre2_match</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> ret</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; errbuf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ret </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; ovector </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2_get_ovector_pointer</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; ret </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">int</span><span style="color: #7c6f64;">)</span><span style="color: #076678;">ovector</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">int</span><span style="color: #7c6f64;">)</span><span style="color: #076678;">ovector</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> ret</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">free_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_compile_context_free</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_compile_context</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_code_free</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_match_data_free</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_match_data</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">ifdef</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">GIT_PCRE2_VERSION_10_34_OR_HIGHER</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_maketables_free</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_tables</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">((</span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">)</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_tables</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">pcre2_general_context_free</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_general_context</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">else</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* !USE_LIBPCRE2 */</span></div>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">cannot use Perl-compatible regexes when not compiled with USE_LIBPCRE</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">pcre2match</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">free_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_fixed_regexp</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> strbuf sb </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> STRBUF_INIT</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> err</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> regflags </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">basic_regex_quote_buf</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> REG_ICASE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; err </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">regcomp</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sb</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> regflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">strbuf_release</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">err</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">errbuf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">1024</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regerror</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">err</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">errbuf</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_regexp_failed</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* !USE_LIBPCRE2 */</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_regexp</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> err</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> regflags </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> REG_NEWLINE</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">word_regexp</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">word_regexp</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">memchr</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">_</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">given pattern contains NULL byte (via -f &lt;file&gt;). This is only supported with -P under PCRE v2</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">));</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">is_fixed</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">ifdef</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">USE_LIBPCRE2</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">no_jit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">(*NO_JIT)</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> no_jit_len </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">no_jit</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">starts_with</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> no_jit</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #b57614;">is_fixed</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> no_jit_len</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> no_jit_len</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160;</span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">fixed</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">ifdef</span><span style="color: #af3a03;"> </span><span style="color: #b57614;">USE_LIBPCRE2</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">is_fixed</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* E.g. t7811-grep-open.sh relies on the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* pattern being restored.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">old_pattern </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> old_patternlen </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> strbuf sb </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> STRBUF_INIT</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* There is the PCRE2_LITERAL flag, but it's</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* only in PCRE v2 10.30 and later. Needing to</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* ifdef our way around that and dealing with</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* it + PCRE2_MULTILINE being an error is more</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* complex than just quoting this ourselves.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">strbuf_add</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\\</span><span style="color: #79740e;">Q</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">2</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">strbuf_add</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">strbuf_add</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\\</span><span style="color: #79740e;">E</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">2</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sb</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sb</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">len</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> old_pattern</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">patternlen</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> old_patternlen</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">strbuf_release</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sb</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">else</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* !USE_LIBPCRE2 */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_fixed_regexp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">#</span><span style="color: #427b58;">endif</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* !USE_LIBPCRE2 */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">ignore_case</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> REG_ICASE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended_regexp_option</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> REG_EXTENDED</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; err </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">regcomp</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> regflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">err</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">errbuf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">1024</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regerror</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">err</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1024</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_regexp_failed</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> errbuf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_not_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">expr</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xcalloc</span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_NODE_NOT</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">unary</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> expr</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> z</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_binexp</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_expr_node </span><span style="color: #076678;">kind</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">left</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xcalloc</span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> kind</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">left</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> left</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> right</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> z</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_or_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_binexp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">GREP_NODE_OR</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> right</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_and_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_binexp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">GREP_NODE_AND</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> right</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_or</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_atom</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #076678;">list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">:</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* atom */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">CALLOC_ARRAY</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_NODE_ATOM</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">atom</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_OPEN_PAREN</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_or</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">)</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">token </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_CLOSE_PAREN</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">unmatched parenthesis</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">)</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_not</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #076678;">list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NOT</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">p</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">next</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--not not followed by pattern expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_not</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--not followed by non pattern expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_not_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_atom</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_and</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #076678;">list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">y</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_not</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_AND</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--and not preceded by pattern expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--and not followed by pattern expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; y </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_and</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">y</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--and not followed by pattern expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_and_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> y</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_or</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #076678;">list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">y</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_and</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> p </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_CLOSE_PAREN</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; y </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_or</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">y</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">not a pattern expression </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_or_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> y</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">compile_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">**</span><span style="color: #076678;">list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_or</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_true_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">void</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xcalloc</span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">z</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_NODE_TRUE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> z</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">prep_header_patterns</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">header_expr</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_HEADER_FIELD_MAX</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_header_field fld</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_list</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">a non-header pattern in grep header list.</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> GREP_HEADER_FIELD_MIN </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; GREP_HEADER_FIELD_MAX </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">unknown header field </span><span style="color: #8f3f71;">%d</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_regexp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">fld </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> fld </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> GREP_HEADER_FIELD_MAX</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> fld</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">fld</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">pp </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_atom</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">pp</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">h </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> pp </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">malformed header expr</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">])</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">continue</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_or_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">h</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; header_expr </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">fld </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> fld </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> GREP_HEADER_FIELD_MAX</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> fld</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">fld</span><span style="color: #7c6f64;">])</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">continue</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">header_expr</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; header_expr </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_true_expr</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; header_expr </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_or_expr</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">header_group</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">fld</span><span style="color: #7c6f64;">],</span><span style="color: #3c3836;"> header_expr</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> header_expr</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #b57614;">grep_splice_or</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">y</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">z </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">assert</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_NODE_OR</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">right</span><span style="color: #3c3836;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_NODE_TRUE</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> y</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> z</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_grep_patterns</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">header_expr </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">prep_header_patterns</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">:</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* atom */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">compile_regexp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">all_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no_body_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> header_expr</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">compile_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">incomplete pattern expression: </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no_body_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_not_expr</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">header_expr</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> header_expr</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">all_match</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_splice_or</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">header_expr</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_or_expr</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;header_expr</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">all_match</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">free_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_TRUE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_ATOM</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_NOT</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.unary</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_AND</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_OR</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.binary.left</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.binary.right</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">free_grep_patterns</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">n</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> n</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; n </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">:</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* atom */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">pcre2_pattern</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free_pcre2_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regfree</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">p</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">free_pattern_expr</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #b57614;">end_of_line</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">cp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">left</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> l </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">l </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">cp </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; l</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; cp</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> l</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> cp</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">word_char</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">ch</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">isalnum</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ch</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> ch </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">_</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">data</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">size</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">color</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">want_color</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">color</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> color </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">color</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">])</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> color</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">color</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> data</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> GIT_COLOR_RESET</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">GIT_COLOR_RESET</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> data</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">output_sep</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sign</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">null_following_name</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\0</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">sign</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SEP</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">show_name</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">name</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">null_following_name</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\0</span><span style="color: #7c6f64;">"</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">patmatch</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pcre2_pattern</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">pcre2match</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> match</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">regexec_buf</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">regexp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> line</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> match</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;eflags</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strip_timestamp</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">**</span><span style="color: #076678;">eol_p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol_p</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">--</span><span style="color: #3c3836;">eol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">&gt;</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">continue</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol_p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">++</span><span style="color: #3c3836;">eol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">field</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> header_field</span><span style="color: #af3a03;">[]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">{</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">author </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">7</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">},</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">{</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">committer </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">10</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">},</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">{</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">reflog </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">7</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">},</span></div>
      <div><span style="color: #7c6f64;">};</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">headerless_match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">start </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">((</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">ctx </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_CONTEXT_HEAD</span><span style="color: #7c6f64;">)))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160;again:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">patmatch</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pmatch</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">hit </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">word_regexp</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">regexp returned nonsense</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Match beginning must be either beginning of the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* line, or at word boundary (i.e. the last char must</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* not be a word char). &#160;Similarly, match end must be</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* either end of the line, or at word boundary</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (i.e. the next char must not be a word char).</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">word_char</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">]))</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #7c6f64;">((</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">eol</span><span style="color: #427b58;">-</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">word_char</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">]))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Words consist of at least one character. */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">hit </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* There could be more than one match on the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* line, and the first match might not be</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* strict word match. &#160;But later ones could be!</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Forward to the next possible start, i.e. the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* next position following a non-word char.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">word_char</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">[</span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">])</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; eflags </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> REG_NOTBOL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> again</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">hit</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+=</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> start</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+=</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> start</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">field</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">assert</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">ARRAY_SIZE</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">header_field</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; field </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">header_field</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; len </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">header_field</span><span style="color: #7c6f64;">[</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">].</span><span style="color: #076678;">len</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">strncmp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> field</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">+=</span><span style="color: #3c3836;"> len</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">field</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_HEADER_AUTHOR</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_HEADER_COMMITTER</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">strip_timestamp</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">headerless_match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> pmatch</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Not a valid grep expression</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_TRUE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_ATOM</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> tmp</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">atom</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">tmp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">h </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">tmp</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">tmp</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.atom</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">token </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">body_hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_NOT</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* Upon visiting a GREP_NODE_NOT, col and icol become swapped.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.unary</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_AND</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.binary.left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">h </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> opt</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">columnnum</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Don't short-circuit AND when given --column, since a</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* NOT earlier in the tree may turn this into an OR. In</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* this case, see the below comment.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">&amp;=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_NODE_OR</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">collect_hits </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> opt</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">columnnum</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Don't short-circuit OR when given --column (or</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* collecting hits) to ensure we don't skip a later</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* child that would produce an earlier match.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.binary.left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">left</span><span style="color: #3c3836;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; h </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">u.binary.right</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> collect_hits</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">die</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Unexpected node type (internal error) </span><span style="color: #8f3f71;">%d</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> h</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">col</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr_eval</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> x</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> collect_hits</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_line</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">icol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_expr</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; collect_hits</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* we do not call with collect_hits without being extended */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> tmp</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">tmp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">columnnum</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* Without --column, any single match on a line</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* is enough to know that it needs to be</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* printed. With --column, scan _all_ patterns</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* to find the earliest.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">tmp</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">col </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">tmp</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_next_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> match</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">headerless_match_one_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">match</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&gt;=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&gt;=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_next_match</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context </span><span style="color: #076678;">ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_header_field </span><span style="color: #076678;">field</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">eflags</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pmatch</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #3c3836;">ctx </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_CONTEXT_HEAD</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">header_list</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_HEAD</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #3c3836;">field </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_HEADER_FIELD_MAX</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">field </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> field</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">continue</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* fall thru */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">:</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* atom */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_PATTERN_BODY</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">|=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_next_pattern</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; pmatch</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">show_line_header</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #076678;">lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">cno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sign</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">heading</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">name</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">heading</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pathname</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">name</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_sep</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">linenum</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">32</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xsnprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">%d</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_LINENO</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_sep</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* Treat 'cno' as the 1-indexed offset from the start of a non-context</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* line to its first match. Otherwise, 'cno' is 0 indicating that we are</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* being called with a context line.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">columnnum</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> cno</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">32</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xsnprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">%</span><span style="color: #7c6f64;">"</span><span style="color: #3c3836;">PRIuMAX</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">uintmax_t</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;">cno</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_COLUMNNO</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_sep</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">show_line</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #076678;">lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> </span><span style="color: #076678;">cno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sign</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> rest </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">match_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">line_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">file_break</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">show_hunk_mark</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pre_context</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">post_context</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">show_hunk_mark</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">2</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SEP</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">lno </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">--</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">2</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SEP</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">only_matching</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* In case the line we're being called with contains more than</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* one match, leave printing each header to the loop below.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line_header</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">color</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">only_matching</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> match</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context ctx </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_CONTEXT_BODY</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> eflags </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">color</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sign </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">:</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; match_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_SELECTED</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; match_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_MATCH_CONTEXT</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sign </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">:</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_SELECTED</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sign </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">-</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_CONTEXT</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sign </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">=</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FUNCTION</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">grep_next_match</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">match</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GREP_HEADER_FIELD_MAX</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eflags</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">only_matching</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line_header</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> line_color</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> match_color</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">only_matching</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">+=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #427b58;">+=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; rest </span><span style="color: #427b58;">-=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">match</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; eflags </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> REG_NOTBOL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">only_matching</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> rest</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> line_color</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> grep_use_locks</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* This lock protects access to the gitattributes machinery, which is</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;* not thread-safe.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160;*/</span></div>
      <div><span style="color: #9d0006;">pthread_mutex_t</span><span style="color: #3c3836;"> grep_attr_mutex</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">inline</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_attr_lock</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">void</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">grep_use_locks</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">pthread_mutex_lock</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">grep_attr_mutex</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">inline</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_attr_unlock</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">void</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">grep_use_locks</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">pthread_mutex_unlock</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">grep_attr_mutex</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">xdemitconf_t</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">xecfg </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">priv</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">xecfg </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">xecfg</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">find_func</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_source_load_driver</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">index</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcname</span><span style="color: #3c3836;">.</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> userdiff_funcname </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">pe </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcname</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xdiff_set_find_func</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pe</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">pe</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">cflags</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; xecfg </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">priv</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #076678;">xecfg</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">find_func</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">xecfg</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">find_func_priv</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&gt;=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">isalpha</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">_</span><span style="color: #7c6f64;">'</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">$</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">show_funcname_line</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #076678;">lno</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">--</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">[</span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; lno</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">lno </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">=</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">is_empty_line</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">show_pre_context</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">end</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #076678;">lno</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> cur </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> funcname_lno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> orig_from</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> funcname_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcname</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> comment_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pre_context</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> lno </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pre_context</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">from </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; orig_from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> from</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> end</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Rewind. */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> cur </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> from</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">next_bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">--</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&gt;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">[</span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; cur</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">comment_needed </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">is_empty_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">)))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> orig_from</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">cur </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> from</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; cur</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> next_bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">funcname_needed </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_lno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> cur</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; from </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> orig_from</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* We need to look even further back to find a function signature. */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcname</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> funcname_needed</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_funcname_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cur</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Back forward. */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">cur </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">cur </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> funcname_lno</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">=</span><span style="color: #7c6f64;">'</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">-</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; eol</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cur</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> sign</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> eol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; cur</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">should_lookahead</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">extended</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* punt for too complex stuff */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">invert</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">token</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_PATTERN</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* punt for "header only" and stuff */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">look_ahead</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">left_p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">lno_p</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">**</span><span style="color: #076678;">bol_p</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> lno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">lno_p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol_p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_pat </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">sp</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">last_bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">regoff_t</span><span style="color: #3c3836;"> earliest </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_list</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">p</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">next</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">regmatch_t</span><span style="color: #3c3836;"> m</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">patmatch</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left_p</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">m</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">hit </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">m</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">m</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_eo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">continue</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">earliest </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">m</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> earliest</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; earliest </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">m</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">rm_so</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">earliest </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol_p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left_p</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left_p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sp </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> earliest</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> sp </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">sp</span><span style="color: #7c6f64;">[</span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">]</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> sp</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* find the beginning of the line */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; last_bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> sp</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">for</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">sp </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> sp </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> last_bol</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> sp</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">sp </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; lno</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">left_p </span><span style="color: #427b58;">-=</span><span style="color: #3c3836;"> last_bol </span><span style="color: #427b58;">-</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol_p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> last_bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">lno_p </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">fill_textconv_grep</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> repository </span><span style="color: #427b58;">*</span><span style="color: #076678;">r</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> userdiff_driver </span><span style="color: #427b58;">*</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> diff_filespec </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">df</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">driver </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">textconv</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* The textconv interface is intimately tied to diff_filespecs, so we</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* have to pretend to be one. If we could unify the grep_source</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* and diff_filespec structs, this mess could just go away.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; df </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">alloc_filespec</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_OID</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">fill_filespec</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">df</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #79740e;">0</span><span style="color: #8f3f71;">100644</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_FILE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">fill_filespec</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">df</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">null_oid</span><span style="color: #7c6f64;">(),</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #79740e;">0</span><span style="color: #8f3f71;">100644</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">attempt to textconv something without a path?</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* fill_textconv is not remotely thread-safe; it modifies the global</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* diff tempfile structure, writes to the_repo's odb and might</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* internally call thread-unsafe functions such as the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* prepare_packed_git() lazy-initializator. Because of the last two, we</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* must ensure mutual exclusion between this call and the object reading</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* API, thus we use obj_read_lock() here.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* TODO: allowing text conversion to run in parallel with object</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* reading operations might increase performance in the multithreaded</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* non-worktreee git-grep with --textconv.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">obj_read_lock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; size </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">fill_textconv</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">r</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> driver</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> df</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">obj_read_unlock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">free_filespec</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">df</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* The normal fill_textconv usage by the diff machinery would just keep</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* the textconv'd buf separate from the diff_filespec. But much of the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* grep code passes around a grep_source and assumes that its "buf"</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* pointer is the beginning of the thing we are searching. So let's</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* install our textconv'd version into the grep_source, taking care not</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* to leak any existing buffer.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_clear_data</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">is_empty_line</span><span style="color: #7c6f64;">(</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">eol</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> eol </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">isspace</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; bol</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> bol </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_1</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #076678;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">peek_bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> left</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> lno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> last_hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> binary_match_only </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> count </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> try_lookahead </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> show_function </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> userdiff_driver </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">textconv </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> grep_context ctx </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_CONTEXT_HEAD</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">xdemitconf_t</span><span style="color: #3c3836;"> xecfg</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">status_only</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep call which could print a name requires </span><span style="color: #7c6f64;">"</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">grep_source.name be non-NULL</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">output</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">output</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> std_output</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pre_context</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">post_context</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">file_break</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Show hunk marks, except for the first file. */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">show_hunk_mark</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* If we're using threads then we can't easily identify</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* the first file. &#160;Always put hunk marks in that case</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* and skip the very first one later in work_done().</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">output</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> std_output</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">show_hunk_mark</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">last_shown</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">allow_textconv</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_source_load_driver</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">index</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* We might set up the shared textconv cache data here, which</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* is not thread-safe. Also, get_oid_with_context() and</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* parse_object() might be internally called. As they are not</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* currently thread-safe and might be racy with object reading,</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* obj_read_lock() must be called.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_attr_lock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">obj_read_lock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; textconv </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">userdiff_get_textconv</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">obj_read_unlock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">grep_attr_unlock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* We know the result of a textconv is text, so we only have to care</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* about binary handling if we are not using it.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">textconv</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_BINARY_DEFAULT</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">grep_source_is_binary</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">repo</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">index</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; binary_match_only </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_BINARY_NOMATCH</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">grep_source_is_binary</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> opt</span><span style="color: #427b58;">-&gt;</span><span style="color: #3c3836;">repo</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">index</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span><span style="color: #3c3836;"> </span><span style="color: #928374;font-style: italic;">/* Assume unmatch */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_BINARY_TEXT</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">default</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">unknown binary handling mode</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">memset</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">priv</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; try_lookahead </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">should_lookahead</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">fill_textconv_grep</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> textconv</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; left </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">left</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">eol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> cno</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">ssize_t</span><span style="color: #3c3836;"> col </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> icol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* look_ahead() skips quickly to the line that possibly</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* has the next hit; don't call it if we need to do</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* something more than just skipping the current line</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* in response to an unmatch for the current line. &#160;E.g.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* inside a post-context window, we will show the current</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* line as a context around the previous hit when it</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* doesn't hit.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">try_lookahead</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">last_hit</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">show_function </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;lno </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> last_hit </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">post_context</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">look_ahead</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">left</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">end_of_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">left</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">((</span><span style="color: #3c3836;">ctx </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> GREP_CONTEXT_HEAD</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">eol </span><span style="color: #427b58;">==</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; ctx </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_CONTEXT_BODY</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">match_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">col</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">icol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> ctx</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> collect_hits</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> next_line</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* "grep -v -e foo -e bla" should list lines</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* that do not have either, so inversion should</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* be done outside.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">invert</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">unmatch_name_only</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">hit</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> next_line</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">hit</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; count</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">status_only</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name_only</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_name</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">count</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> next_line</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">binary_match_only</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">Binary file </span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">12</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">),</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #79740e;"> matches</span><span style="color: #8f3f71;">\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">9</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Hit at this line. &#160;If we haven't shown the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* pre-context lines, we would need to show them.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pre_context</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_pre_context</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">else</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcname</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_funcname_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">invert</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> icol </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> col</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">cno </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* A negative cno indicates that there was no</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* match on the line. We are thus inverted and</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* being asked to show all lines that _don't_</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* match a given expression. Therefore, set cno</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* to 0 to suggest the whole line matches.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> cno </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">:</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; last_hit </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">funcbody</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; show_function </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> next_line</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">show_function </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">peek_bol </span><span style="color: #9d0006;">||</span><span style="color: #3c3836;"> peek_bol </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> peek_left </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> left</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">peek_eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Trailing empty lines are not interesting.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Peek past them to see if they belong to the</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* body of the current function.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; peek_bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">is_empty_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">peek_bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> peek_eol</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; peek_bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> peek_eol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; peek_eol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">end_of_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">peek_bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">peek_left</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">match_funcname</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> peek_bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> peek_eol</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; show_function </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">show_function </span><span style="color: #9d0006;">||</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">last_hit </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> lno </span><span style="color: #427b58;">&lt;=</span><span style="color: #3c3836;"> last_hit </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">post_context</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* If the last hit is within the post context,</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* we need to show this line.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_line</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> bol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> eol</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> lno</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> col </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">-</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; next_line:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; bol </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> eol </span><span style="color: #427b58;">+</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #3c3836;">left</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; left</span><span style="color: #427b58;">--</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; lno</span><span style="color: #427b58;">++</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">collect_hits</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">status_only</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">unmatch_name_only</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">unmatch_name_only</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* We did not see any hit, so we want to show this */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">show_name</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">xdiff_clear_find_func</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">xecfg</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">priv</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* NEEDSWORK:</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* The real "grep -c foo *.c" gives many "bar.c:0" lines,</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* which feels mostly useless but sometimes useful. &#160;Maybe</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* make it another option? &#160;For now suppress them.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">count</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> count</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">[</span><span style="color: #8f3f71;">32</span><span style="color: #7c6f64;">];</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pathname</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_color</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">),</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">colors</span><span style="color: #7c6f64;">[</span><span style="color: #3c3836;">GREP_COLOR_FILENAME</span><span style="color: #7c6f64;">]);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">output_sep</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">'</span><span style="color: #79740e;">:</span><span style="color: #7c6f64;">'</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">xsnprintf</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">sizeof</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">"</span><span style="color: #8f3f71;">%u\n</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> count</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #b57614;">output</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">strlen</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">buf</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!!</span><span style="color: #3c3836;">last_hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">clr_hit_marker</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* All-hit markers are meaningful only at the very top level</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* OR node.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_NODE_OR</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">left</span><span style="color: #3c3836;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">chk_hit_marker</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_expr </span><span style="color: #427b58;">*</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Top level nodes have hit markers. &#160;See if they all are hits */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">while</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">node</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> GREP_NODE_OR</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">left</span><span style="color: #3c3836;">-&gt;</span><span style="color: #076678;">hit</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; x </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">x</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">u</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">binary</span><span style="color: #3c3836;">.</span><span style="color: #076678;">right</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/*</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* we do not have to do the two-pass grep when we do not check</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* buffer-wide "all-match".</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">all_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no_body_match</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_1</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #928374;font-style: italic;">/* Otherwise the toplevel "or" terms hit a bit differently.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;* We first clear hit markers from them.</span></div>
      <div><span style="color: #928374;font-style: italic;">&#160; &#160; &#160;*/</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">clr_hit_marker</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">body_hit</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_1</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">all_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">!</span><span style="color: #b57614;">chk_hit_marker</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">pattern_expression</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">no_body_match</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">&amp;&amp;</span><span style="color: #3c3836;"> </span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">body_hit</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_1</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_init_buf</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> </span><span style="color: #076678;">size</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_SOURCE_BUF</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_buffer</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_opt </span><span style="color: #427b58;">*</span><span style="color: #076678;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">unsigned</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">long</span><span style="color: #3c3836;"> </span><span style="color: #076678;">size</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source gs</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> r</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_init_buf</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; r </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">opt</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_clear</span><span style="color: #7c6f64;">(</span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> r</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_init_file</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_SOURCE_FILE</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xstrdup_or_null</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">name</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xstrdup_or_null</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xstrdup</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_init_oid</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> object_id </span><span style="color: #427b58;">*</span><span style="color: #076678;">oid</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> repository </span><span style="color: #427b58;">*</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> GREP_SOURCE_OID</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xstrdup_or_null</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">name</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xstrdup_or_null</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">oiddup</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">oid</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> repo</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_clear</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">FREE_AND_NULL</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">FREE_AND_NULL</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">FREE_AND_NULL</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_clear_data</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_clear_data</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_FILE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_OID</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* these types own the buffer */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">((</span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;">gs</span><span style="color: #427b58;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">NULL</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_BUF</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #928374;font-style: italic;">/* leave user-provided buf intact */</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">break</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load_oid</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">enum</span><span style="color: #3c3836;"> object_type type</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">repo_read_object_file</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">repo</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">type</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #427b58;">&amp;</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">error</span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">_</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">'</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">': unable to read </span><span style="color: #8f3f71;">%s</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">),</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">name</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #b57614;">oid_to_hex</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #7c6f64;">));</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load_file</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #af3a03;">const</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">filename </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">identifier</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> stat st</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">char</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">*</span><span style="color: #3c3836;">data</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">size_t</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> i</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">lstat</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">filename</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&amp;</span><span style="color: #3c3836;">st</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; err_ret:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">errno </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> ENOENT</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #b57614;">error_errno</span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">_</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">failed to stat '</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">'</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> filename</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">S_ISREG</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">st</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">st_mode</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; size </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xsize_t</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">st</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">st_size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; i </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">open</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">filename</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> O_RDONLY</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i </span><span style="color: #427b58;">&lt;</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">goto</span><span style="color: #3c3836;"> err_ret</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; data </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">xmallocz</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">size</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">st</span><span style="color: #7c6f64;">.</span><span style="color: #076678;">st_size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">read_in_full</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> data</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">))</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">error_errno</span><span style="color: #7c6f64;">(</span><span style="color: #b57614;">_</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">'</span><span style="color: #8f3f71;">%s</span><span style="color: #79740e;">': short read</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">),</span><span style="color: #3c3836;"> filename</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">close</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #b57614;">free</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">data</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">close</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">i</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> data</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> size</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">switch</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">type</span><span style="color: #7c6f64;">)</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_FILE</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load_file</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_OID</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load_oid</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">case</span><span style="color: #3c3836;"> GREP_SOURCE_BUF</span><span style="color: #7c6f64;">:</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">?</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">:</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #7c6f64;">}</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">BUG</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">invalid grep_source type to load</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #9d0006;">void</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_load_driver</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> index_state </span><span style="color: #427b58;">*</span><span style="color: #076678;">istate</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_attr_lock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">userdiff_find_by_path</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">istate</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">path</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">=</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">userdiff_find_by_name</span><span style="color: #7c6f64;">(</span><span style="color: #7c6f64;">"</span><span style="color: #79740e;">default</span><span style="color: #7c6f64;">"</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_attr_unlock</span><span style="color: #7c6f64;">();</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
      <div><span style="color: #af3a03;">static</span><span style="color: #3c3836;"> </span><span style="color: #9d0006;">int</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">grep_source_is_binary</span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> grep_source </span><span style="color: #427b58;">*</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">,</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #9d0006;">struct</span><span style="color: #3c3836;"> index_state </span><span style="color: #427b58;">*</span><span style="color: #076678;">istate</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #7c6f64;">{</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #b57614;">grep_source_load_driver</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> istate</span><span style="color: #7c6f64;">);</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">binary</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">!=</span><span style="color: #3c3836;"> </span><span style="color: #427b58;">-</span><span style="color: #8f3f71;">1</span><span style="color: #7c6f64;">)</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">driver</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">binary</span><span style="color: #7c6f64;">;</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">if</span><span style="color: #3c3836;"> </span><span style="color: #7c6f64;">(</span><span style="color: #9d0006;">!</span><span style="color: #b57614;">grep_source_load</span><span style="color: #7c6f64;">(</span><span style="color: #3c3836;">gs</span><span style="color: #7c6f64;">))</span></div>
      <div><span style="color: #3c3836;">&#160; &#160; &#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #b57614;">buffer_is_binary</span><span style="color: #7c6f64;">(</span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">buf</span><span style="color: #7c6f64;">,</span><span style="color: #3c3836;"> </span><span style="color: #076678;">gs</span><span style="color: #7c6f64;">-&gt;</span><span style="color: #076678;">size</span><span style="color: #7c6f64;">);</span></div>
      <br>
      <div><span style="color: #3c3836;">&#160; &#160; </span><span style="color: #9d0006;">return</span><span style="color: #3c3836;"> </span><span style="color: #8f3f71;">0</span><span style="color: #7c6f64;">;</span></div>
      <div><span style="color: #7c6f64;">}</span></div>
      <br>
    </div>
    <!--EndFragment-->
  </body>
</html>
