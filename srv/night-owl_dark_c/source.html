<html>
  <body>
    <!--StartFragment-->
    <div style="color: #d6deeb;background-color: #011627;font-family: Consolas, 'Courier New', monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;">
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">cache.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">config.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">object-store.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">userdiff.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">xdiff-interface.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">diff.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">diffcore.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">commit.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">quote.h</span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">include</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">help.h</span><span style="color: #d9f5dd;">"</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_is_binary</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> index_state </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">istate</span><span style="color: #d6deeb;">);</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">std_output</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">buf</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">size</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">fwrite</span><span style="color: #82aaff;">(buf, size, </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, stdout)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt grep_defaults </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .relative </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .pathname </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .max_depth </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .pattern_type_option </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_UNSPECIFIED,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .colors </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_CONTEXT] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">""</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_FILENAME] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_MAGENTA,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_FUNCTION] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">""</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_LINENO] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_GREEN,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_COLUMNNO] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_GREEN,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_MATCH_CONTEXT] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_BOLD_RED,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_MATCH_SELECTED] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_BOLD_RED,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_SELECTED] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">""</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; [GREP_COLOR_SEP] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GIT_COLOR_CYAN,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; },</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .only_matching </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; .output </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> std_output,</span></div>
      <div><span style="color: #d6deeb;">};</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">color_grep_slots</span><span style="color: #c792ea;font-style: italic;">[]</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_CONTEXT] &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">context</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_FILENAME] &#160; &#160; &#160; </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">filename</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_FUNCTION] &#160; &#160; &#160; </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">function</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_LINENO] &#160; &#160; </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">lineNumber</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_COLUMNNO] &#160; &#160; &#160; </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">column</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_MATCH_CONTEXT] &#160;</span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">matchContext</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_MATCH_SELECTED] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">matchSelected</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_SELECTED] &#160; &#160; &#160; </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">selected</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; [GREP_COLOR_SEP] &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">separator</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">};</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">parse_pattern_type_arg</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">arg</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(arg, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">default</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_UNSPECIFIED;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(arg, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">basic</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_BRE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(arg, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">extended</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_ERE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(arg, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">fixed</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_FIXED;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(arg, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">perl</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_PCRE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">bad </span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;"> argument: </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, opt, arg)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #82aaff;font-style: italic;">define_list_config_array_extra</span><span style="color: #d6deeb;">(color_grep_slots, {</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">match</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">});</span></div>
      <br>
      <div><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* Read the configuration file once and store it in</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* the grep_defaults template.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_config</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">var</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">value</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">cb</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">opt </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #d6deeb;">grep_defaults;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">slot;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">userdiff_config</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* The instance of grep_opt that we set up here is copied by</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* grep_init() to be used by each individual invocation.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* When populating a new field of this structure here, be</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* sure to think about ownership -- e.g., you might need to</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* override the shallow copy in grep_init() with a deep copy.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.extendedregexp</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">git_config_bool</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.patterntype</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_type_option</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">parse_pattern_type_arg</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.linenumber</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">linenum</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">git_config_bool</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.column</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">columnnum</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">git_config_bool</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep.fullname</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">relative</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">git_config_bool</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">color.grep</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">color</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">git_config_colorbool</span><span style="color: #82aaff;">(var, value)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">strcmp</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">color.grep.match</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">grep_config</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">color.grep.matchcontext</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, value, cb)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">grep_config</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">color.grep.matchselected</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, value, cb)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">skip_prefix</span><span style="color: #82aaff;">(var, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">color.grep.</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">slot)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> i </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">LOOKUP_CONFIG</span><span style="color: #82aaff;">(color_grep_slots, slot)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">color;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (i </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[i];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">value)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">config_error_nonbool</span><span style="color: #82aaff;">(var)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">color_parse</span><span style="color: #82aaff;">(value, color)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* Initialize one instance of grep_opt and copy the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* default values from the template we read the configuration</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* information in an earlier call to git_config(grep_config).</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_init</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> repository </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">repo</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">prefix</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">opt </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> grep_defaults;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> repo;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">prefix</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> prefix;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">prefix_length</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> (prefix </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">prefix) </span><span style="color: #c792ea;">?</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #d6deeb;">(prefix) </span><span style="color: #c792ea;">:</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_tail</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_tail</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_list</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_set_pattern_type_option</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_pattern_type </span><span style="color: #d7dbe0;">pattern_type</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* When committing to the pattern type by setting the relevant</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* fields in grep_opt it's generally not necessary to zero out</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* the fields we're not choosing, since they won't have been</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* set by anything. The extended_regexp_option field is the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* only exception to this.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* This is because in the process of parsing grep.patternType</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* &amp; grep.extendedRegexp we set opt-&gt;pattern_type_option and</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* opt-&gt;extended_regexp_option, respectively. We then</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* internally use opt-&gt;extended_regexp_option to see if we're</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* compiling an ERE. It must be unset if that's not actually</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* the case.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (pattern_type </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_ERE </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (pattern_type) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_UNSPECIFIED:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> fall through </span><span style="color: #637777;">*/</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_BRE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_ERE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_FIXED:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_PCRE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_commit_pattern_type</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_pattern_type </span><span style="color: #d7dbe0;">pattern_type</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (pattern_type </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_UNSPECIFIED)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_set_pattern_type_option</span><span style="color: #82aaff;">(pattern_type, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_type_option</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN_TYPE_UNSPECIFIED)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_set_pattern_type_option</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_type_option</span><span style="color: #82aaff;">, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* This branch *must* happen after setting from the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* opt-&gt;pattern_type_option above, we don't want</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* grep.extendedRegexp to override grep.patternType!</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_set_pattern_type_option</span><span style="color: #82aaff;">(GREP_PATTERN_TYPE_ERE, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">create_grep_pat</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pat</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">patlen</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">origin</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">no</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_pat_token </span><span style="color: #d7dbe0;">t</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_header_field </span><span style="color: #d7dbe0;">field</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xcalloc</span><span style="color: #82aaff;">(</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">p))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xmemdupz</span><span style="color: #82aaff;">(pat, patlen)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> patlen;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> origin;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> no;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> t;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> field;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> p;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">do_append_grep_pat</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">***</span><span style="color: #d7dbe0;">tail</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">**</span><span style="color: #d6deeb;">tail </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">tail </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN: </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> atom </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (;;) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">new_pat;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> len </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">cp </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;">, </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">nl </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">len </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">(</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">cp) </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; nl </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> cp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">nl)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; new_pat </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">create_grep_pat</span><span style="color: #82aaff;">(nl </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, len </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">no</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">new_pat</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">tail </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">new_pat</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> new_pat;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">nl </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\0</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">-=</span><span style="color: #d6deeb;"> len;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">append_header_grep_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_header_field </span><span style="color: #d7dbe0;">field</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pat</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">create_grep_pat</span><span style="color: #82aaff;">(pat, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(pat), </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">header</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GREP_PATTERN_HEAD, field)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (field </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_HEADER_REFLOG)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">use_reflog_filter</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">do_append_grep_pat</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">header_tail</span><span style="color: #82aaff;">, p)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">append_grep_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pat</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">origin</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">no</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_pat_token </span><span style="color: #d7dbe0;">t</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">append_grep_pat</span><span style="color: #82aaff;">(opt, pat, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(pat), origin, no, t)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">append_grep_pat</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pat</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">patlen</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">origin</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">no</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_pat_token </span><span style="color: #d7dbe0;">t</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">create_grep_pat</span><span style="color: #82aaff;">(pat, patlen, origin, no, t, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">do_append_grep_pat</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_tail</span><span style="color: #82aaff;">, p)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_opt_dup</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">pat;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">ret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xmalloc</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(</span><span style="color: #c792ea;">struct</span><span style="color: #82aaff;"> grep_opt))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">ret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">opt;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">ret</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">ret</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_tail</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">ret</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;">(pat </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; pat </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">; pat </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pat</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;">(</span><span style="color: #c5e478;">pat</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">append_header_grep_pattern</span><span style="color: #82aaff;">(ret, </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">append_grep_pat</span><span style="color: #82aaff;">(ret, </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">no</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">pat</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> ret;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> NORETURN </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_regexp_failed</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">error</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">where</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">1024</span><span style="color: #d6deeb;">];</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xsnprintf</span><span style="color: #82aaff;">(where, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(where), </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">In '</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">' at </span><span style="color: #82aaff;">%d</span><span style="color: #ecc48d;">, </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">no</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xsnprintf</span><span style="color: #82aaff;">(where, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(where), </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">, </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">origin</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">where</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">'</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">': </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, where, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, error)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">is_fixed</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">s</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">len</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> i;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (i </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; i </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> len; i</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">is_regex_special</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">s</span><span style="color: #82aaff;">[i])</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">ifdef</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">USE_LIBPCRE2</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">define</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">GREP_PCRE2_DEBUG_MALLOC</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">pcre2_malloc</span><span style="color: #d6deeb;">(PCRE2_SIZE </span><span style="color: #d7dbe0;">size</span><span style="color: #d6deeb;">, MAYBE_UNUSED </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">memory_data</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">pointer </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">malloc</span><span style="color: #82aaff;">(size)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">GREP_PCRE2_DEBUG_MALLOC</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> count </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">fprintf</span><span style="color: #82aaff;">(stderr, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">PCRE2:</span><span style="color: #82aaff;">%p</span><span style="color: #ecc48d;"> -&gt; #</span><span style="color: #82aaff;">%02d</span><span style="color: #ecc48d;">: alloc(</span><span style="color: #82aaff;">%lu</span><span style="color: #ecc48d;">)</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, pointer, count</span><span style="color: #c792ea;">++</span><span style="color: #82aaff;">, size)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> pointer;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_free</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pointer</span><span style="color: #d6deeb;">, MAYBE_UNUSED </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">memory_data</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">GREP_PCRE2_DEBUG_MALLOC</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> count </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (pointer)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">fprintf</span><span style="color: #82aaff;">(stderr, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">PCRE2:</span><span style="color: #82aaff;">%p</span><span style="color: #ecc48d;"> -&gt; #</span><span style="color: #82aaff;">%02d</span><span style="color: #ecc48d;">: free()</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, pointer, count</span><span style="color: #c792ea;">++</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #82aaff;">(pointer)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pcre2_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> error;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; PCRE2_UCHAR </span><span style="color: #c5e478;">errbuf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">256</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; PCRE2_SIZE erroffset;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> options </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> PCRE2_MULTILINE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> jitret;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> patinforet;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> jitsizearg;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> literal </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;">);</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* Call pcre2_general_context_create() before calling any</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* other pcre2_*(). It sets up our malloc()/free() functions</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* with which everything else is allocated.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_general_context_create</span><span style="color: #82aaff;">(</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; pcre2_malloc, pcre2_free, NULL)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Couldn't allocate PCRE2 general context</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_locale</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">has_non_ascii</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_tables</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_maketables</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_compile_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_compile_context_create</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_set_character_tables</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_compile_context</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_tables</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; options </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> PCRE2_CASELESS;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_locale</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">is_utf8_locale</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">literal)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; options </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> (PCRE2_UTF </span><span style="color: #7fdbca;">|</span><span style="color: #d6deeb;"> PCRE2_MATCH_INVALID_UTF);</span></div>
      <br>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">ifdef</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">GIT_PCRE2_VERSION_10_36_OR_HIGHER</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Work around https://bugs.exim.org/show_bug.cgi?id=2642 fixed in 10.36 </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (PCRE2_MATCH_INVALID_UTF </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> options </span><span style="color: #7fdbca;">&amp;</span><span style="color: #d6deeb;"> (PCRE2_UTF </span><span style="color: #7fdbca;">|</span><span style="color: #d6deeb;"> PCRE2_CASELESS))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; options </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> PCRE2_NO_START_OPTIMIZE;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_compile</span><span style="color: #82aaff;">((PCRE2_SPTR)</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;">, options, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">error, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">erroffset,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_compile_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_match_data_create_from_pattern</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Couldn't allocate PCRE2 match data</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_get_error_message</span><span style="color: #82aaff;">(error, errbuf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(errbuf))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_regexp_failed</span><span style="color: #82aaff;">(p, (</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">char</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">)</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">errbuf)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_config</span><span style="color: #82aaff;">(PCRE2_CONFIG_JIT, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_jit_on</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_jit_on</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; jitret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_jit_compile</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">, PCRE2_JIT_COMPLETE)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (jitret)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Couldn't JIT the PCRE2 pattern '</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">', got '</span><span style="color: #82aaff;">%d</span><span style="color: #ecc48d;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, jitret)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* The pcre2_config(PCRE2_CONFIG_JIT, ...) call just</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* tells us whether the library itself supports JIT,</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* but to see whether we're going to be actually using</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* JIT we need to extract PCRE2_INFO_JITSIZE from the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* pattern *after* we do pcre2_jit_compile() above.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* This is because if the pattern contains the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (*NO_JIT) verb (see pcre2syntax(3))</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* pcre2_jit_compile() will exit early with 0. If we</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* then proceed to call pcre2_jit_match() further down</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* the line instead of pcre2_match() we'll either</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* segfault (pre PCRE 10.31) or run into a fatal error</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (post PCRE2 10.31)</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; patinforet </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_pattern_info</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">, PCRE2_INFO_JITSIZE, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">jitsizearg)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (patinforet)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">pcre2_pattern_info() failed: </span><span style="color: #82aaff;">%d</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, patinforet)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (jitsizearg </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_jit_on</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2match</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">line</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">match</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> ret, flags </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; PCRE2_SIZE </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">ovector;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; PCRE2_UCHAR </span><span style="color: #c5e478;">errbuf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">256</span><span style="color: #d6deeb;">];</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (eflags </span><span style="color: #7fdbca;">&amp;</span><span style="color: #d6deeb;"> REG_NOTBOL)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; flags </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> PCRE2_NOTBOL;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_jit_on</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_jit_match</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">, (</span><span style="color: #c792ea;">unsigned</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">char</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">)line,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> line, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, flags, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; NULL)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_match</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">, (</span><span style="color: #c792ea;">unsigned</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">char</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">)line,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> line, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, flags, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; NULL)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (ret </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> ret </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> PCRE2_ERROR_NOMATCH) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_get_error_message</span><span style="color: #82aaff;">(ret, errbuf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(errbuf))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;"> failed with error code </span><span style="color: #82aaff;">%d</span><span style="color: #ecc48d;">: </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; (</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_jit_on</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">?</span><span style="color: #82aaff;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">pcre2_jit_match</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">:</span><span style="color: #82aaff;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">pcre2_match</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">), ret,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; errbuf)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (ret </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ovector </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2_get_ovector_pointer</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ret </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;">)</span><span style="color: #c5e478;">ovector</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;">)</span><span style="color: #c5e478;">ovector</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> ret;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">free_pcre2_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_compile_context_free</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_compile_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_code_free</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_match_data_free</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_match_data</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">ifdef</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">GIT_PCRE2_VERSION_10_34_OR_HIGHER</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_maketables_free</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_tables</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #82aaff;">((</span><span style="color: #c792ea;">void</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">)</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_tables</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pcre2_general_context_free</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pcre2_general_context</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> !USE_LIBPCRE2 </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pcre2_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">cannot use Perl-compatible regexes when not compiled with USE_LIBPCRE</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">pcre2match</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">line</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">match</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">free_pcre2_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_fixed_regexp</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> strbuf sb </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> STRBUF_INIT;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> err;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> regflags </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">basic_regex_quote_buf</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> REG_ICASE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; err </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">regcomp</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">regexp</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">sb</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">buf</span><span style="color: #82aaff;">, regflags)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strbuf_release</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (err) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">errbuf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">1024</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">regerror</span><span style="color: #82aaff;">(err, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">regexp</span><span style="color: #82aaff;">, errbuf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(errbuf))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_regexp_failed</span><span style="color: #82aaff;">(p, errbuf)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span><span style="color: #d6deeb;"> </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> !USE_LIBPCRE2 </span><span style="color: #637777;">*/</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_regexp</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> err;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> regflags </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> REG_NEWLINE;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">word_regexp</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">word_regexp</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">memchr</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #82aaff;font-style: italic;">_</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">given pattern contains NULL byte (via -f &lt;file&gt;). This is only supported with -P under PCRE v2</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">))</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">is_fixed</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">ifdef</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">USE_LIBPCRE2</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">no_jit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">(*NO_JIT)</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> no_jit_len </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(no_jit)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">starts_with</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, no_jit)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #82aaff;font-style: italic;">is_fixed</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> no_jit_len,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> no_jit_len)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160;}</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">fixed</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">ifdef</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">USE_LIBPCRE2</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">is_fixed</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_pcre2_pattern</span><span style="color: #82aaff;">(p, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* E.g. t7811-grep-open.sh relies on the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* pattern being restored.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">old_pattern </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> old_patternlen </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> strbuf sb </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> STRBUF_INIT;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* There is the PCRE2_LITERAL flag, but it's</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* only in PCRE v2 10.30 and later. Needing to</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* ifdef our way around that and dealing with</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* it + PCRE2_MULTILINE being an error is more</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* complex than just quoting this ourselves.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strbuf_add</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\\</span><span style="color: #ecc48d;">Q</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">2</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strbuf_add</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strbuf_add</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\\</span><span style="color: #ecc48d;">E</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">2</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">sb</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">sb</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">len</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_pcre2_pattern</span><span style="color: #82aaff;">(p, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> old_pattern;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">patternlen</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> old_patternlen;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strbuf_release</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sb)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> !USE_LIBPCRE2 </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_fixed_regexp</span><span style="color: #82aaff;">(p, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #c792ea;">#</span><span style="color: #c792ea;font-style: italic;">endif</span><span style="color: #d6deeb;"> </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> !USE_LIBPCRE2 </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_pcre2_pattern</span><span style="color: #82aaff;">(p, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">ignore_case</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> REG_ICASE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended_regexp_option</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; regflags </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> REG_EXTENDED;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; err </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">regcomp</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">regexp</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, regflags)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (err) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">errbuf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">1024</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">regerror</span><span style="color: #82aaff;">(err, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">regexp</span><span style="color: #82aaff;">, errbuf, </span><span style="color: #f78c6c;">1024</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_regexp_failed</span><span style="color: #82aaff;">(p, errbuf)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_not_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">expr</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">z </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xcalloc</span><span style="color: #82aaff;">(</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">z))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_NODE_NOT;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">unary</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> expr;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> z;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_binexp</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_expr_node </span><span style="color: #d7dbe0;">kind</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">left</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">right</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">z </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xcalloc</span><span style="color: #82aaff;">(</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">z))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> kind;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">left</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> left;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> right;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> z;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_or_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">left</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">right</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_binexp</span><span style="color: #82aaff;">(GREP_NODE_OR, left, right)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_and_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">left</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">right</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_binexp</span><span style="color: #82aaff;">(GREP_NODE_AND, left, right)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_or</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_atom</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">x;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">p)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN: </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> atom </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">CALLOC_ARRAY</span><span style="color: #d6deeb;">(x, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_NODE_ATOM;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">atom</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> x;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_OPEN_PAREN:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_or</span><span style="color: #d6deeb;">(list);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list)</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">token </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_CLOSE_PAREN)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">unmatched parenthesis</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list)</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">next;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> x;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_not</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">x;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">p)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NOT:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">p</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">next)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--not not followed by pattern expression</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_not</span><span style="color: #d6deeb;">(list);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">x)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--not followed by non pattern expression</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_not_expr</span><span style="color: #d6deeb;">(x);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_atom</span><span style="color: #d6deeb;">(list);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_and</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">x, </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">y;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_not</span><span style="color: #82aaff;">(list)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_AND) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">x)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--and not preceded by pattern expression</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--and not followed by pattern expression</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; y </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_and</span><span style="color: #82aaff;">(list)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">y)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--and not followed by pattern expression</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_and_expr</span><span style="color: #82aaff;">(x, y)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> x;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_or</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">x, </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">y;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_and</span><span style="color: #82aaff;">(list)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">list;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (x </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> p </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_CLOSE_PAREN) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; y </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_or</span><span style="color: #82aaff;">(list)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">y)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">not a pattern expression </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_or_expr</span><span style="color: #82aaff;">(x, y)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> x;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">compile_pattern_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_or</span><span style="color: #82aaff;">(list)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_true_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">z </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xcalloc</span><span style="color: #82aaff;">(</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">z))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">z</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_NODE_TRUE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> z;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">prep_header_patterns</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">header_expr;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">(</span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[GREP_HEADER_FIELD_MAX]);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_header_field fld;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_list</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">a non-header pattern in grep header list.</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> GREP_HEADER_FIELD_MIN </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; GREP_HEADER_FIELD_MAX </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">unknown header field </span><span style="color: #82aaff;">%d</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_regexp</span><span style="color: #82aaff;">(p, opt)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (fld </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; fld </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> GREP_HEADER_FIELD_MAX; fld</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[fld] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">h;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">pp </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> p;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_atom</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">pp)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">h </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> pp </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">malformed header expr</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">]) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> h;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">continue</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_or_expr</span><span style="color: #82aaff;">(h, </span><span style="color: #c5e478;">header_group</span><span style="color: #82aaff;">[</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #82aaff;">])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; header_expr </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (fld </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; fld </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> GREP_HEADER_FIELD_MAX; fld</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">header_group</span><span style="color: #d6deeb;">[fld])</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">continue</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">header_expr)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; header_expr </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_true_expr</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; header_expr </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_or_expr</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">header_group</span><span style="color: #82aaff;">[fld], header_expr)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> header_expr;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">grep_splice_or</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">x</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">y</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">z </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> x;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (x) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">assert</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">x</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">==</span><span style="color: #82aaff;"> GREP_NODE_OR)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_NODE_TRUE) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> y;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> z;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_grep_patterns</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">header_expr </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">prep_header_patterns</span><span style="color: #82aaff;">(opt)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN: </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> atom </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">compile_regexp</span><span style="color: #d6deeb;">(p, opt);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">all_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no_body_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> header_expr)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (p)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">compile_pattern_expr</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">p)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (p)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">incomplete pattern expression: </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no_body_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_not_expr</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">header_expr)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> header_expr;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">all_match</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_splice_or</span><span style="color: #82aaff;">(header_expr,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_or_expr</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;header_expr)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">all_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">free_pattern_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">x</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_TRUE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_ATOM:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_NOT:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_pattern_expr</span><span style="color: #d6deeb;">(x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.unary);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_AND:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_OR:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_pattern_expr</span><span style="color: #d6deeb;">(x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.binary.left);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_pattern_expr</span><span style="color: #d6deeb;">(x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.binary.right);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #82aaff;">(x)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">free_grep_patterns</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p, </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">n;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> n) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; n </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN: </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> atom </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (p</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">pcre2_pattern)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_pcre2_pattern</span><span style="color: #d6deeb;">(p);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">regfree</span><span style="color: #d6deeb;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #d6deeb;">p</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">regexp</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #d6deeb;">(p</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">pattern</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #82aaff;">(p)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_pattern_expr</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;font-style: italic;">end_of_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">cp</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">left</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> l </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">left;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (l </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">cp </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; l</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; cp</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">left </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> l;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> cp;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">word_char</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">ch</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">isalnum</span><span style="color: #82aaff;">(ch)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> ch </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">_</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">data</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">size</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">color</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">want_color</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">color</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> color </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">color</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">]) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, color, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(color)</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, data, size</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, GIT_COLOR_RESET, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(GIT_COLOR_RESET)</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, data, size</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">output_sep</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">sign</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">null_following_name</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\0</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">sign, </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_SEP])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">show_name</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">name</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, name, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(name), </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_FILENAME])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">null_following_name</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">?</span><span style="color: #82aaff;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\0</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">:</span><span style="color: #82aaff;"> </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">patmatch</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">line</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">match</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pcre2_pattern</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">pcre2match</span><span style="color: #82aaff;">(p, line, eol, match, eflags)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">regexec_buf</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">regexp</span><span style="color: #82aaff;">, line, eol </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> line, </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, match,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;eflags)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">strip_timestamp</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">eol_p</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol_p;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">eol) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">&gt;</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">continue</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol_p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">eol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">field;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> len;</span></div>
      <div><span style="color: #d6deeb;">} header_field</span><span style="color: #c792ea;font-style: italic;">[]</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; { </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">author </span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">, </span><span style="color: #f78c6c;">7</span><span style="color: #d6deeb;"> },</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; { </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">committer </span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">, </span><span style="color: #f78c6c;">10</span><span style="color: #d6deeb;"> },</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; { </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">reflog </span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">, </span><span style="color: #f78c6c;">7</span><span style="color: #d6deeb;"> },</span></div>
      <div><span style="color: #d6deeb;">};</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">headerless_match_one_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pmatch</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">start </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> ((</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN) </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ((</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD) </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> (ctx </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_CONTEXT_HEAD)))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160;again:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">patmatch</span><span style="color: #82aaff;">(p, bol, eol, pmatch, eflags)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (hit </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">word_regexp</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> ((</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; (eol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> bol) </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; (</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; (eol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> bol) </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">regexp returned nonsense</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Match beginning must be either beginning of the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* line, or at word boundary (i.e. the last char must</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* not be a word char). &#160;Similarly, match end must be</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* either end of the line, or at word boundary</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* (i.e. the next char must not be a word char).</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> ( ((</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">word_char</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">bol</span><span style="color: #82aaff;">[</span><span style="color: #c5e478;">pmatch</span><span style="color: #82aaff;">[</span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">])</span><span style="color: #d6deeb;">) </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;((</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> (eol</span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;">bol)) </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">word_char</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">bol</span><span style="color: #82aaff;">[</span><span style="color: #c5e478;">pmatch</span><span style="color: #82aaff;">[</span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">].</span><span style="color: #c5e478;">rm_eo</span><span style="color: #82aaff;">])</span><span style="color: #d6deeb;">) )</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; ;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Words consist of at least one character. </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">hit </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> eol) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> There could be more than one match on the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* line, and the first match might not be</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* strict word match. &#160;But later ones could be!</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Forward to the next possible start, i.e. the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* next position following a non-word char.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">word_char</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">bol</span><span style="color: #82aaff;">[</span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">])</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> eol)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; eflags </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> REG_NOTBOL;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> eol)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> again;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (hit) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">+=</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> start;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">+=</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> start;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_one_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">, </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pmatch</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">field;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> len;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">assert</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">p</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #82aaff;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #82aaff;"> </span><span style="color: #82aaff;font-style: italic;">ARRAY_SIZE</span><span style="color: #82aaff;">(header_field))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; field </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">header_field</span><span style="color: #d6deeb;">[</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; len </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">header_field</span><span style="color: #d6deeb;">[</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">].</span><span style="color: #c5e478;">len</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">strncmp</span><span style="color: #82aaff;">(bol, field, len)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">+=</span><span style="color: #d6deeb;"> len;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">field</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_HEADER_AUTHOR:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_HEADER_COMMITTER:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">strip_timestamp</span><span style="color: #d6deeb;">(bol, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">headerless_match_one_pattern</span><span style="color: #82aaff;">(p, bol, eol, ctx, pmatch, eflags)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">x</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">col</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">icol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">collect_hits</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">x)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Not a valid grep expression</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_TRUE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_ATOM:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> tmp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_one_pattern</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">x</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">atom</span><span style="color: #82aaff;">, bol, eol, ctx,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">tmp, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (h </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">tmp</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">tmp</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.atom</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">token </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">body_hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> h;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_NOT:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* Upon visiting a GREP_NODE_NOT, col and icol become swapped.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #d6deeb;">(opt, x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.unary, bol, eol, ctx, icol, col,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_AND:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #d6deeb;">(opt, x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.binary.left, bol, eol, ctx, col,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; icol, </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (h </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> opt</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">columnnum) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Don't short-circuit AND when given --column, since a</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* NOT earlier in the tree may turn this into an OR. In</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* this case, see the below comment.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">&amp;=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">x</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">binary</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">right</span><span style="color: #82aaff;">, bol, eol,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;ctx, col, icol, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_NODE_OR:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">(collect_hits </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> opt</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">columnnum)) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Don't short-circuit OR when given --column (or</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* collecting hits) to ensure we don't skip a later</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* child that would produce an earlier match.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">x</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">binary</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">left</span><span style="color: #82aaff;">, bol, eol,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ctx, col, icol, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">x</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">binary</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">right</span><span style="color: #82aaff;">, bol,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; eol, ctx, col, icol, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #d6deeb;">(opt, x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.binary.left, bol, eol, ctx, col,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; icol, </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (collect_hits)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">left</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> h;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; h </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #d6deeb;">(opt, x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">u.binary.right, bol, eol, ctx, col,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;icol, collect_hits);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">die</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Unexpected node type (internal error) </span><span style="color: #82aaff;">%d</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">, x</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">node</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (collect_hits)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> h;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> h;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">col</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">icol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">collect_hits</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr_eval</span><span style="color: #82aaff;">(opt, x, bol, eol, ctx, col, icol, collect_hits)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">col</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">icol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">collect_hits</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_expr</span><span style="color: #82aaff;">(opt, bol, eol, ctx, col, icol,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; collect_hits)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> we do not call with collect_hits without being extended </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> tmp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">match_one_pattern</span><span style="color: #82aaff;">(p, bol, eol, ctx, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">tmp, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">columnnum</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* Without --column, any single match on a line</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* is enough to know that it needs to be</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* printed. With --column, scan _all_ patterns</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* to find the earliest.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">tmp</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">col </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">tmp</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_next_pattern</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pmatch</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> match;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">headerless_match_one_pattern</span><span style="color: #82aaff;">(p, bol, eol, ctx, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">match, eflags)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&gt;=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&gt;=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_next_match</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context </span><span style="color: #d7dbe0;">ctx</span><span style="color: #d6deeb;">, </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">pmatch</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_header_field </span><span style="color: #d7dbe0;">field</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">eflags</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">pmatch</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> eol) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> ((ctx </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_CONTEXT_HEAD)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">?</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">header_list</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">:</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_HEAD:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> ((field </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_HEADER_FIELD_MAX) </span><span style="color: #c792ea;">&amp;&amp;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (p</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">field </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> field))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">continue</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> fall thru </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN: </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> atom </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_PATTERN_BODY:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">|=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_next_pattern</span><span style="color: #d6deeb;">(p, bol, eol, ctx,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; pmatch, eflags);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">show_line_header</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">name</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">lno</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">cno</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">sign</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">heading</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, name, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(name), </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_FILENAME])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> lno;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">heading</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pathname</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, name, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(name), </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_FILENAME])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_sep</span><span style="color: #82aaff;">(opt, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">linenum</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">32</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xsnprintf</span><span style="color: #82aaff;">(buf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(buf), </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">%d</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, lno)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, buf, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(buf), </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_LINENO])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_sep</span><span style="color: #82aaff;">(opt, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* Treat 'cno' as the 1-indexed offset from the start of a non-context</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* line to its first match. Otherwise, 'cno' is 0 indicating that we are</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* being called with a context line.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">columnnum</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> cno) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">32</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xsnprintf</span><span style="color: #82aaff;">(buf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(buf), </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">%</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">PRIuMAX, (</span><span style="color: #c792ea;">uintmax_t</span><span style="color: #82aaff;">)cno)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, buf, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(buf), </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_COLUMNNO])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_sep</span><span style="color: #82aaff;">(opt, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">show_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">name</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">lno</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">cno</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">sign</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> rest </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> eol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">match_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">line_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">file_break</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">show_hunk_mark</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pre_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">post_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">show_hunk_mark</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">2</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_SEP])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (lno </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">--</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">2</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_SEP])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">only_matching</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* In case the line we're being called with contains more than</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* one match, leave printing each header to the loop below.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line_header</span><span style="color: #82aaff;">(opt, name, lno, cno, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">color</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">only_matching</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> match;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context ctx </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_CONTEXT_BODY;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> eflags </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">color</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (sign </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">:</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; match_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[GREP_COLOR_MATCH_SELECTED];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; match_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[GREP_COLOR_MATCH_CONTEXT];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (sign </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">:</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[GREP_COLOR_SELECTED];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (sign </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">-</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[GREP_COLOR_CONTEXT];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (sign </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">=</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; line_color </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #d6deeb;">[GREP_COLOR_FUNCTION];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">grep_next_match</span><span style="color: #82aaff;">(opt, bol, eol, ctx, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">match,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GREP_HEADER_FIELD_MAX, eflags)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">only_matching</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line_header</span><span style="color: #82aaff;">(opt, name, lno, cno, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, bol, </span><span style="color: #c5e478;">match</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #82aaff;">, line_color)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, bol </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> </span><span style="color: #c5e478;">match</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">match</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> </span><span style="color: #c5e478;">match</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #82aaff;">, match_color)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">only_matching</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">+=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #c792ea;">+=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; rest </span><span style="color: #c792ea;">-=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">match</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; eflags </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> REG_NOTBOL;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">only_matching</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, bol, rest, line_color)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> grep_use_locks;</span></div>
      <br>
      <div><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* This lock protects access to the gitattributes machinery, which is</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;* not thread-safe.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #c792ea;">pthread_mutex_t</span><span style="color: #d6deeb;"> grep_attr_mutex;</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">inline</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_attr_lock</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (grep_use_locks)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pthread_mutex_lock</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">grep_attr_mutex)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">inline</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_attr_unlock</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (grep_use_locks)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">pthread_mutex_unlock</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">grep_attr_mutex)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">xdemitconf_t</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">xecfg </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">priv</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (xecfg </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">xecfg</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">find_func</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_load_driver</span><span style="color: #82aaff;">(gs, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">index</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcname</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">pattern</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> userdiff_funcname </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">pe </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcname</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xdiff_set_find_func</span><span style="color: #82aaff;">(xecfg, </span><span style="color: #c5e478;">pe</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">pe</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">cflags</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; } </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; xecfg </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">priv</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (xecfg) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">xecfg</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">find_func</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">bol, eol </span><span style="color: #7fdbca;">-</span><span style="color: #82aaff;"> bol, buf, </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">xecfg</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">find_func_priv</span><span style="color: #d6deeb;">) </span><span style="color: #c792ea;">&gt;=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> eol)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">isalpha</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">bol)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">_</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">$</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">show_funcname_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">lno</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">bol;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">bol</span><span style="color: #d6deeb;">[</span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; lno</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (lno </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #82aaff;">(opt, gs, bol, eol)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line</span><span style="color: #82aaff;">(opt, bol, eol, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, lno, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">=</span><span style="color: #d9f5dd;">'</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">is_empty_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">);</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">show_pre_context</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">end</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">lno</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> cur </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> lno, from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">, funcname_lno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">, orig_from;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> funcname_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcname</span><span style="color: #d6deeb;">, comment_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pre_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> lno)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> lno </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pre_context</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (from </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; orig_from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> from;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #82aaff;">(opt, gs, bol, end)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Rewind. </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> cur </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> from) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">next_bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">bol;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">bol</span><span style="color: #d6deeb;">[</span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; bol</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; cur</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (comment_needed </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">is_empty_line</span><span style="color: #82aaff;">(bol, eol)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #82aaff;">(opt, gs, bol, eol)</span><span style="color: #d6deeb;">)) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> orig_from;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (cur </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> from) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; cur</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> next_bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (funcname_needed </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #82aaff;">(opt, gs, bol, eol)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_lno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> cur;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; funcname_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; comment_needed </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; from </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> orig_from;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> We need to look even further back to find a function signature. </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcname</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> funcname_needed)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_funcname_line</span><span style="color: #82aaff;">(opt, gs, bol, cur)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Back forward. </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (cur </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> lno) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol, sign </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> (cur </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> funcname_lno) </span><span style="color: #c792ea;">?</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">=</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">:</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">-</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; eol</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line</span><span style="color: #82aaff;">(opt, bol, eol, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, cur, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, sign)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> eol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; cur</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">should_lookahead</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">extended</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> punt for too complex stuff </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">invert</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">token</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_PATTERN)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> punt for "header only" and stuff </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">look_ahead</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">left_p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">lno_p</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">**</span><span style="color: #d7dbe0;">bol_p</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> lno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">lno_p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol_p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_pat </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">sp, </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">last_bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">regoff_t</span><span style="color: #d6deeb;"> earliest </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pattern_list</span><span style="color: #d6deeb;">; p; p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">p</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">next</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">regmatch_t</span><span style="color: #d6deeb;"> m;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">patmatch</span><span style="color: #82aaff;">(p, bol, bol </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> </span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">left_p, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">m, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">hit </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">m</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">m</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_eo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">continue</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (earliest </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">m</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> earliest)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; earliest </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">m</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">rm_so</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (earliest </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol_p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">left_p;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">left_p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (sp </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> earliest; bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> sp </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">sp</span><span style="color: #d6deeb;">[</span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">] </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">; sp</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; ; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> find the beginning of the line </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; last_bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> sp;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">for</span><span style="color: #d6deeb;"> (sp </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol; sp </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> last_bol; sp</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">sp </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #d9f5dd;">'</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">'</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; lno</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">left_p </span><span style="color: #c792ea;">-=</span><span style="color: #d6deeb;"> last_bol </span><span style="color: #7fdbca;">-</span><span style="color: #d6deeb;"> bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol_p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> last_bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">lno_p </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> lno;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">fill_textconv_grep</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> repository </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">r</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> userdiff_driver </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">driver</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> diff_filespec </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">df;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">buf;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> size;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">driver </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">textconv</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load</span><span style="color: #82aaff;">(gs)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* The textconv interface is intimately tied to diff_filespecs, so we</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* have to pretend to be one. If we could unify the grep_source</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* and diff_filespec structs, this mess could just go away.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; df </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">alloc_filespec</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_OID:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">fill_filespec</span><span style="color: #d6deeb;">(df, gs</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">identifier</span><span style="color: #d6deeb;">, </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">, </span><span style="color: #ffeb95;">0</span><span style="color: #f78c6c;">100644</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_FILE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">fill_filespec</span><span style="color: #d6deeb;">(df, </span><span style="color: #82aaff;font-style: italic;">null_oid</span><span style="color: #d6deeb;">(), </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">, </span><span style="color: #ffeb95;">0</span><span style="color: #f78c6c;">100644</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">attempt to textconv something without a path?</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* fill_textconv is not remotely thread-safe; it modifies the global</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* diff tempfile structure, writes to the_repo's odb and might</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* internally call thread-unsafe functions such as the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* prepare_packed_git() lazy-initializator. Because of the last two, we</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* must ensure mutual exclusion between this call and the object reading</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* API, thus we use obj_read_lock() here.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* TODO: allowing text conversion to run in parallel with object</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* reading operations might increase performance in the multithreaded</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* non-worktreee git-grep with --textconv.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">obj_read_lock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; size </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">fill_textconv</span><span style="color: #82aaff;">(r, driver, df, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">buf)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">obj_read_unlock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free_filespec</span><span style="color: #82aaff;">(df)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* The normal fill_textconv usage by the diff machinery would just keep</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* the textconv'd buf separate from the diff_filespec. But much of the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* grep code passes around a grep_source and assumes that its "buf"</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* pointer is the beginning of the thing we are searching. So let's</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* install our textconv'd version into the grep_source, taking care not</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* to leak any existing buffer.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_clear_data</span><span style="color: #82aaff;">(gs)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> buf;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> size;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">is_empty_line</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">bol</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">eol</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> eol </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">isspace</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">*</span><span style="color: #82aaff;">bol)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; bol</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> bol </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> eol;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_1</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">collect_hits</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">peek_bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> left;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> lno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> last_hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> binary_match_only </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> count </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> try_lookahead </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> show_function </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> userdiff_driver </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">textconv </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> grep_context ctx </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_CONTEXT_HEAD;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">xdemitconf_t</span><span style="color: #d6deeb;"> xecfg;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">status_only</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep call which could print a name requires </span><span style="color: #d9f5dd;">"</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">grep_source.name be non-NULL</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">output</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">output</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> std_output;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pre_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">post_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">file_break</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Show hunk marks, except for the first file. </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">show_hunk_mark</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* If we're using threads then we can't easily identify</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* the first file. &#160;Always put hunk marks in that case</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* and skip the very first one later in work_done().</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">output</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> std_output)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">show_hunk_mark</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">last_shown</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">allow_textconv</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_load_driver</span><span style="color: #82aaff;">(gs, </span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">index</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* We might set up the shared textconv cache data here, which</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* is not thread-safe. Also, get_oid_with_context() and</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* parse_object() might be internally called. As they are not</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* currently thread-safe and might be racy with object reading,</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* obj_read_lock() must be called.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_attr_lock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">obj_read_lock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; textconv </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">userdiff_get_textconv</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">obj_read_unlock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_attr_unlock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* We know the result of a textconv is text, so we only have to care</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* about binary handling if we are not using it.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">textconv) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_BINARY_DEFAULT:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">grep_source_is_binary</span><span style="color: #d6deeb;">(gs, opt</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">repo</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">index</span><span style="color: #d6deeb;">))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; binary_match_only </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_BINARY_NOMATCH:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">grep_source_is_binary</span><span style="color: #d6deeb;">(gs, opt</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d6deeb;">repo</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">index</span><span style="color: #d6deeb;">))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Assume unmatch </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_BINARY_TEXT:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">default</span><span style="color: #d6deeb;">:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #d6deeb;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">unknown binary handling mode</span><span style="color: #d9f5dd;">"</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">memset</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">xecfg, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(xecfg))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">priv</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">&amp;</span><span style="color: #d6deeb;">xecfg;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; try_lookahead </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">should_lookahead</span><span style="color: #82aaff;">(opt)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">fill_textconv_grep</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #82aaff;">, textconv, gs)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; left </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (left) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">eol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> hit;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> cno;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">ssize_t</span><span style="color: #d6deeb;"> col </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">, icol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* look_ahead() skips quickly to the line that possibly</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* has the next hit; don't call it if we need to do</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* something more than just skipping the current line</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* in response to an unmatch for the current line. &#160;E.g.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* inside a post-context window, we will show the current</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* line as a context around the previous hit when it</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* doesn't hit.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (try_lookahead</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">(last_hit</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (show_function </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;lno </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> last_hit </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">post_context</span><span style="color: #d6deeb;">))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">look_ahead</span><span style="color: #82aaff;">(opt, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">left, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">lno, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">bol)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">end_of_line</span><span style="color: #82aaff;">(bol, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">left)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> ((ctx </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> GREP_CONTEXT_HEAD) </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (eol </span><span style="color: #c792ea;">==</span><span style="color: #d6deeb;"> bol))</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; ctx </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_CONTEXT_BODY;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">match_line</span><span style="color: #82aaff;">(opt, bol, eol, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">col, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">icol, ctx, collect_hits)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (collect_hits)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> next_line;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> "grep -v -e foo -e bla" should list lines</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* that do not have either, so inversion should</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;* be done outside.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">invert</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">hit;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">unmatch_name_only</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (hit)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> next_line;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (hit) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; count</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">status_only</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">name_only</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_name</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">count</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> next_line;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (binary_match_only) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">Binary file </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">12</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">),</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_FILENAME])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, </span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;"> matches</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, </span><span style="color: #f78c6c;">9</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Hit at this line. &#160;If we haven't shown the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* pre-context lines, we would need to show them.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pre_context</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_pre_context</span><span style="color: #82aaff;">(opt, gs, bol, eol, lno)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">else</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcname</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_funcname_line</span><span style="color: #82aaff;">(opt, gs, bol, lno)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">invert</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">?</span><span style="color: #d6deeb;"> icol </span><span style="color: #c792ea;">:</span><span style="color: #d6deeb;"> col;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (cno </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* A negative cno indicates that there was no</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* match on the line. We are thus inverted and</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* being asked to show all lines that _don't_</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* match a given expression. Therefore, set cno</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;* to 0 to suggest the whole line matches.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; cno </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line</span><span style="color: #82aaff;">(opt, bol, eol, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, lno, cno </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">:</span><span style="color: #d9f5dd;">'</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; last_hit </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> lno;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">funcbody</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; show_function </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> next_line;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (show_function </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">peek_bol </span><span style="color: #c792ea;">||</span><span style="color: #d6deeb;"> peek_bol </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> bol)) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> peek_left </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> left;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">peek_eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> eol;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Trailing empty lines are not interesting.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* Peek past them to see if they belong to the</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* body of the current function.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; peek_bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> bol;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">is_empty_line</span><span style="color: #82aaff;">(peek_bol, peek_eol)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; peek_bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> peek_eol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; peek_eol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">end_of_line</span><span style="color: #82aaff;">(peek_bol, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">peek_left)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">match_funcname</span><span style="color: #82aaff;">(opt, gs, peek_bol, peek_eol)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; show_function </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (show_function </span><span style="color: #c792ea;">||</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; (last_hit </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> lno </span><span style="color: #c792ea;">&lt;=</span><span style="color: #d6deeb;"> last_hit </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">post_context</span><span style="color: #d6deeb;">)) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> If the last hit is within the post context,</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;* we need to show this line.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_line</span><span style="color: #82aaff;">(opt, bol, eol, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, lno, col </span><span style="color: #7fdbca;">+</span><span style="color: #82aaff;"> </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">, </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">-</span><span style="color: #d9f5dd;">'</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; next_line:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; bol </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> eol </span><span style="color: #7fdbca;">+</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #d6deeb;">left)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; left</span><span style="color: #7fdbca;">--</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; lno</span><span style="color: #c792ea;">++</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (collect_hits)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">status_only</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">unmatch_name_only</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">unmatch_name_only</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> We did not see any hit, so we want to show this </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">show_name</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xdiff_clear_find_func</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">xecfg)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">priv</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> NEEDSWORK:</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* The real "grep -c foo *.c" gives many "bar.c:0" lines,</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* which feels mostly useless but sometimes useful. &#160;Maybe</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* make it another option? &#160;For now suppress them.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">count</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> count) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">[</span><span style="color: #f78c6c;">32</span><span style="color: #d6deeb;">];</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">pathname</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_color</span><span style="color: #82aaff;">(opt, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">),</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">colors</span><span style="color: #82aaff;">[GREP_COLOR_FILENAME])</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">output_sep</span><span style="color: #82aaff;">(opt, </span><span style="color: #d9f5dd;">'</span><span style="color: #ecc48d;">:</span><span style="color: #d9f5dd;">'</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">xsnprintf</span><span style="color: #82aaff;">(buf, </span><span style="color: #7fdbca;">sizeof</span><span style="color: #82aaff;">(buf), </span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">%u</span><span style="color: #f78c6c;">\n</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">, count)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #82aaff;font-style: italic;">output</span><span style="color: #d6deeb;">(</span><span style="color: #82aaff;">opt, buf, </span><span style="color: #82aaff;font-style: italic;">strlen</span><span style="color: #82aaff;">(buf)</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!!</span><span style="color: #d6deeb;">last_hit;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">clr_hit_marker</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">x</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> All-hit markers are meaningful only at the very top level</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* OR node.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_NODE_OR)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">left</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">chk_hit_marker</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_expr </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">x</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Top level nodes have hit markers. &#160;See if they all are hits </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">while</span><span style="color: #d6deeb;"> (</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">node</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> GREP_NODE_OR)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">left</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">hit</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; x </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">x</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">u</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">right</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* we do not have to do the two-pass grep when we do not check</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* buffer-wide "all-match".</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">all_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no_body_match</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_1</span><span style="color: #82aaff;">(opt, gs, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> Otherwise the toplevel "or" terms hit a bit differently.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;* We first clear hit markers from them.</span></div>
      <div><span style="color: #637777;font-style: italic;">&#160; &#160; &#160;</span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">clr_hit_marker</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">body_hit</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_1</span><span style="color: #82aaff;">(opt, gs, </span><span style="color: #f78c6c;">1</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">all_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">chk_hit_marker</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">opt</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">pattern_expression</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">no_body_match</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&amp;&amp;</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">opt</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">body_hit</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_1</span><span style="color: #82aaff;">(opt, gs, </span><span style="color: #f78c6c;">0</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_init_buf</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">buf</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">size</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_SOURCE_BUF;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> buf;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> size;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_buffer</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_opt </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">opt</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">buf</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;">unsigned</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">long</span><span style="color: #d6deeb;"> </span><span style="color: #d7dbe0;">size</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source gs;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> r;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_init_buf</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">gs, buf, size)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; r </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source</span><span style="color: #82aaff;">(opt, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">gs)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_clear</span><span style="color: #82aaff;">(</span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">gs)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> r;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_init_file</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">name</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">path</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_SOURCE_FILE;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xstrdup_or_null</span><span style="color: #82aaff;">(name)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xstrdup_or_null</span><span style="color: #82aaff;">(path)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xstrdup</span><span style="color: #82aaff;">(path)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_init_oid</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">name</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">path</span><span style="color: #d6deeb;">, </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> object_id </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">oid</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> repository </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">repo</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> GREP_SOURCE_OID;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xstrdup_or_null</span><span style="color: #82aaff;">(name)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xstrdup_or_null</span><span style="color: #82aaff;">(path)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">oiddup</span><span style="color: #82aaff;">(oid)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> repo;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_clear</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">FREE_AND_NULL</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">FREE_AND_NULL</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">FREE_AND_NULL</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_clear_data</span><span style="color: #82aaff;">(gs)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_clear_data</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_FILE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_OID:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> these types own the buffer </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #d6deeb;">((</span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">)gs</span><span style="color: #7fdbca;">-</span><span style="color: #c792ea;">&gt;</span><span style="color: #d7dbe0;">buf</span><span style="color: #d6deeb;">);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;">NULL</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_BUF:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #637777;">/*</span><span style="color: #637777;font-style: italic;"> leave user-provided buf intact </span><span style="color: #637777;">*/</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">break</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load_oid</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">enum</span><span style="color: #d6deeb;"> object_type type;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">repo_read_object_file</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">repo</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #82aaff;">, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">type,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #7fdbca;">&amp;</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">error</span><span style="color: #82aaff;">(</span><span style="color: #82aaff;font-style: italic;">_</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">'</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">': unable to read </span><span style="color: #82aaff;">%s</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">),</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">name</span><span style="color: #82aaff;">,</span></div>
      <div><span style="color: #82aaff;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #82aaff;font-style: italic;">oid_to_hex</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #82aaff;">))</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load_file</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">const</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">filename </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">identifier</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> stat st;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">char</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">*</span><span style="color: #d6deeb;">data;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">size_t</span><span style="color: #d6deeb;"> size;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> i;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #82aaff;font-style: italic;">lstat</span><span style="color: #82aaff;">(filename, </span><span style="color: #7fdbca;">&amp;</span><span style="color: #82aaff;">st)</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; err_ret:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (errno </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> ENOENT)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">error_errno</span><span style="color: #82aaff;">(</span><span style="color: #82aaff;font-style: italic;">_</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">failed to stat '</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">'</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">), filename)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">S_ISREG</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">st</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">st_mode</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; size </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xsize_t</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">st</span><span style="color: #82aaff;">.</span><span style="color: #c5e478;">st_size</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; i </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">open</span><span style="color: #82aaff;">(filename, O_RDONLY)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (i </span><span style="color: #c792ea;">&lt;</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">goto</span><span style="color: #d6deeb;"> err_ret;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; data </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">xmallocz</span><span style="color: #82aaff;">(size)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">st</span><span style="color: #d6deeb;">.</span><span style="color: #c5e478;">st_size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">read_in_full</span><span style="color: #82aaff;">(i, data, size)</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">error_errno</span><span style="color: #82aaff;">(</span><span style="color: #82aaff;font-style: italic;">_</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">'</span><span style="color: #82aaff;">%s</span><span style="color: #ecc48d;">': short read</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">), filename)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">close</span><span style="color: #82aaff;">(i)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #82aaff;font-style: italic;">free</span><span style="color: #82aaff;">(data)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">close</span><span style="color: #82aaff;">(i)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> data;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> size;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">switch</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">type</span><span style="color: #d6deeb;">) {</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_FILE:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load_file</span><span style="color: #d6deeb;">(gs);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_OID:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load_oid</span><span style="color: #d6deeb;">(gs);</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">case</span><span style="color: #d6deeb;"> GREP_SOURCE_BUF:</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">?</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">:</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; }</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">BUG</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">invalid grep_source type to load</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;">void</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_load_driver</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> index_state </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">istate</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_attr_lock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">userdiff_find_by_path</span><span style="color: #82aaff;">(istate, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">path</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">=</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">userdiff_find_by_name</span><span style="color: #82aaff;">(</span><span style="color: #d9f5dd;">"</span><span style="color: #ecc48d;">default</span><span style="color: #d9f5dd;">"</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_attr_unlock</span><span style="color: #82aaff;">()</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
      <div><span style="color: #c792ea;font-style: italic;">static</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">int</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">grep_source_is_binary</span><span style="color: #d6deeb;">(</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> grep_source </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">gs</span><span style="color: #d6deeb;">,</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</span><span style="color: #c792ea;">struct</span><span style="color: #d6deeb;"> index_state </span><span style="color: #7fdbca;">*</span><span style="color: #d7dbe0;">istate</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">{</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #82aaff;font-style: italic;">grep_source_load_driver</span><span style="color: #82aaff;">(gs, istate)</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;"> </span><span style="color: #c792ea;">!=</span><span style="color: #d6deeb;"> </span><span style="color: #7fdbca;">-</span><span style="color: #f78c6c;">1</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #c5e478;">gs</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">driver</span><span style="color: #d6deeb;">-&gt;</span><span style="color: #c5e478;">binary</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">if</span><span style="color: #d6deeb;"> (</span><span style="color: #c792ea;">!</span><span style="color: #82aaff;font-style: italic;">grep_source_load</span><span style="color: #82aaff;">(gs)</span><span style="color: #d6deeb;">)</span></div>
      <div><span style="color: #d6deeb;">&#160; &#160; &#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #82aaff;font-style: italic;">buffer_is_binary</span><span style="color: #82aaff;">(</span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">buf</span><span style="color: #82aaff;">, </span><span style="color: #c5e478;">gs</span><span style="color: #82aaff;">-&gt;</span><span style="color: #c5e478;">size</span><span style="color: #82aaff;">)</span><span style="color: #d6deeb;">;</span></div>
      <br>
      <div><span style="color: #d6deeb;">&#160; &#160; </span><span style="color: #c792ea;font-style: italic;">return</span><span style="color: #d6deeb;"> </span><span style="color: #f78c6c;">0</span><span style="color: #d6deeb;">;</span></div>
      <div><span style="color: #d6deeb;">}</span></div>
      <br>
    </div>
    <!--EndFragment-->
  </body>
</html>
